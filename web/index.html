<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>NoButt Test</title>
    <link rel="stylesheet" href="index.css" />
  </head>

  <body>
    <div class="page">
      <div class="options-header">
        <span class="option" id="server-connection-bulb"></span>
      </div>

      <div class="tab-header">
        <div class="tab-link" data-tab="element-grid">Toy</div>
        <div class="tab-link" data-tab="log-console">Log</div>
      </div>
      <hr />
      <div id="element-grid" class="tab-content">
        <!-- <div class="element-wrapper long-element-wrapper"></div> -->
      </div>
      <div id="log-console" class="tab-content"><div id="logs"></div></div>
    </div>
  </body>
  <script type="text/javascript">
    function logToConsole(message) {
      const consoleElement = document.getElementById("logs");
      const messageElement = document.createElement("div");
      messageElement.textContent = message;
      consoleElement.appendChild(messageElement);
      consoleElement.scrollTop = consoleElement.scrollHeight; // Прокрутка вниз
    }
    logToConsole("Console:");
  </script>
  <script type="text/javascript">
    // Tab selector script
    document.addEventListener("DOMContentLoaded", function () {
      const tabs = document.querySelectorAll(".tab-link");
      const contents = document.querySelectorAll(".tab-content");
      //if we haven't got any tabs we are not able to push them
      if (tabs.length <= 1) {
        return;
      }

      tabs.forEach((tab) => {
        tab.addEventListener("click", function () {
          const target = this.getAttribute("data-tab");

          tabs.forEach((t) => t.classList.remove("active"));
          contents.forEach((c) => c.classList.add("inactive"));

          this.classList.add("active");
          document.getElementById(target).classList.remove("inactive");
        });
      });

      contents.forEach((content) => {
        content.classList.add("inactive");
      });
      contents[0].classList.remove("inactive");

      tabs[0].classList.add("active");
    });
  </script>

  <script type="text/javascript">
    let plug_vibration_level = 0;
    let reconnectInterval = 1000;
    let socket;
    let serverIndicatorStages = ["Server offline", "Server connected", "Error"];

    const bulb = document.getElementById("server-connection-bulb");

    socket = new WebSocket("ws://127.0.0.1:12345/ui");
    console.log("WebSocket created");

    socket.addEventListener("open", (event) => {
      bulb.classList.add("active");
      bulb.title = serverIndicatorStages[1];
    });

    socket.addEventListener("close", (event) => {
      bulb.classList.remove("active");
      bulb.title = serverIndicatorStages[0];
    });

    socket.addEventListener("error", (event) => {
      bulb.classList.add("error");
      bulb.title = serverIndicatorStages[2];
      console.error("WebSocket error: ", event);
      logToConsole("WebSocket error");
      setTimeout(function () {
        bulb.classList.remove("error");
      }, 500);
    });

    socket.addEventListener("message", function (event) {
      console.log("Message from server ", event.data);
      logToConsole("Message from server: " + event.data);

      const message = JSON.parse(event.data);
      handleMessage(message);
    });

    function handleMessage(message) {
      if (message.s)
        if (message.ScalarCmd && message.ScalarCmd.Scalars) {
          handleScalarCmd(message);
        } else if (message.StopAllDevices || message.StopDevice) {
          handleStopCmd(message);
        } else {
          console.warn("Unknown message type: ", message);
        }
    }

    function handleScalarCmd(message) {
      console.log("Received scalar: ", message.ScalarCmd.Scalars[0].Scalar);
      plug_vibration_level = message.ScalarCmd.Scalars[0].Scalar;
      // infinite shaking animation
      document.getElementById("plug").style.animation = `shake ${
        (1 - plug_vibration_level) / 2
      }s infinite`;
    }

    function handleStopCmd(message) {
      console.log("Received stop command");
      plug_vibration_level = 0;
      // stop shaking animation
      document.getElementById("plug").style.animation = "";
    }
  </script>

  <script src="index.js"></script>
  <script type="text/javascript">
    let toysNumber = 0;
    class Toy {
      constructor(containerId) {
        this.container = document.getElementById(containerId);
        toysNumber += 1;
        this.init();
      }

      init() {
        this.createElements();
      }

      createElements() {
        this.wrapper = document.createElement("div");
        this.wrapper.className = "element-wrapper movable-element-wrapper";

        this.closeButton = document.createElement("span");
        this.closeButton.textContent = "×";
        this.closeButton.className = "close-button";
        this.closeButton.addEventListener("click", () => this.remove());

        this.wrapper.textContent = `Toy ${toysNumber}`;

        this.img = document.createElement("img");
        this.img.src = "./resources/plug.png";
        this.img.className = "plug";

        this.wrapper.appendChild(this.img);

        this.container.appendChild(this.wrapper);
      }

      remove() {
        this.wrapper.remove();
      }
    }

    new Toy("element-grid");
    new Toy("element-grid");
    new Toy("element-grid");
    new Toy("element-grid");
    new Toy("element-grid");
    new Toy("element-grid");
    new Toy("element-grid");
    new Toy("element-grid");
    new Toy("element-grid");
  </script>
</html>
<!-- initWebSocket() {
        let plug_vibration_level = 0;
        let socket;
        let serverIndicatorStages = [
          "Server offline",
          "Server connected",
          "Error",
        ];
        const bulb = document.getElementById("server-connection-bulb");
        socket = new WebSocket("ws://127.0.0.1:12345/ui");
        console.log("WebSocket created");
        handleMessage2(socket);
        socket.addEventListener("open", (event) => {
          bulb.classList.add("active");
          bulb.title = serverIndicatorStages[1];
        });
        socket.addEventListener("close", (event) => {
          bulb.classList.remove("active");
          bulb.title = serverIndicatorStages[0];
        });
        socket.addEventListener("error", (event) => {
          bulb.classList.add("error");
          bulb.title = serverIndicatorStages[2];
          console.error("WebSocket error: ", event);
          logToConsole("WebSocket error");
          setTimeout(function () {
            bulb.classList.remove("error");
          }, 500);
        });
        socket.addEventListener("message", function (event) {
          console.log("Message from server ", event.data);
          logToConsole("Message from server: " + event.data);
          const message = JSON.parse(event.data);
          handleMessage(message);
        });
        function handleMessage(message) {
          if (message.s)
            if (message.ScalarCmd && message.ScalarCmd.Scalars) {
              handleScalarCmd(message);
            } else if (message.StopAllDevices || message.StopDevice) {
              handleStopCmd(message);
            } else {
              console.warn("Unknown message type: ", message);
            }
        }
        function handleScalarCmd(message) {
          console.log("Received scalar: ", message.ScalarCmd.Scalars[0].Scalar);
          plug_vibration_level = message.ScalarCmd.Scalars[0].Scalar;
          // infinite shaking animation
          document.getElementById("plug").style.animation = `shake ${
            (1 - plug_vibration_level) / 2
          }s infinite`;
        }
        function handleStopCmd(message) {
          console.log("Received stop command");
          plug_vibration_level = 0;
          // stop shaking animation
          document.getElementById("plug").style.animation = "";
        }
      } -->
