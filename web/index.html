<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>NoButt Test</title>
    <style>
      :root {
        --shake-angle: 3deg;
      }

      @keyframes shake {
        0% {
          transform: rotate(-var(--shake-angle));
        }

        50% {
          transform: rotate(var(--shake-angle));
        }

        100% {
          transform: rotate(-var(--shake-angle));
        }
      }

      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: white;
      }

      .page {
        display: flex;
        flex-direction: column;
      }

      .tab-header {
        display: flex;
        cursor: pointer;
        margin: 10px;
        margin-bottom: 0px;
        border-radius: 10px 10px 0 0;
        background-color: rgb(255, 197, 71);
      }

      .tab-header div {
        padding: 14px 16px;
        flex: 1;
        border-radius: 10px 10px 0 0;
        text-align: center;
        transition: background-color 0.25s;
        border-top: 4px solid rgb(255, 197, 71);
        border-left: 4px solid rgb(255, 197, 71);
        border-right: 4px solid rgb(255, 197, 71);
      }

      .tab-header div:hover {
        background-color: #9177ae;
      }

      .tab-header div.active {
        background-color: #80669d;
      }

      .tab-content {
        display: none;
        padding: 20px;
        border: 1px solid;
      }

      .tab-content.active {
        display: block;
      }

      hr {
        border: 3px solid rgb(255, 197, 71);
        margin: 0;
        padding: 0;
      }

      .options-header {
        display: flex;
        justify-content: flex-end;
        padding: 10px;
        padding-bottom: 0px;
      }
      .option button {
        height: 20px;
        width: 20px;
        cursor: pointer;
        padding: 5px;
        margin: 0px 3px;
        border-radius: 20%;
      }

      /* #sfw-button {
      } */

      #server-connection-bulb {
        height: 20px;
        width: 20px;
        border: 2px solid rgb(96, 96, 96);
        border-radius: 50%;
        background: radial-gradient(
          circle,
          rgba(201, 201, 201, 1) 33%,
          rgba(108, 108, 108, 1) 100%
        );
      }
      #server-connection-bulb.active {
        border: 2px solid rgb(89, 151, 79);
        background: radial-gradient(
          circle,
          rgba(6, 222, 23, 1) 33%,
          rgb(100, 169, 89) 100%
        );
      }

      #server-connection-bulb.error {
        border: 2px solid rgb(94, 17, 17);
        background: radial-gradient(
          circle,
          rgba(222, 6, 47, 1) 33%,
          rgba(113, 21, 21, 1) 100%
        );
      }
    </style>
  </head>

  <body>
    <div class="page">
      <div class="options-header">
        <div class="option" id="theme-button">
          <button></button>
        </div>
        <span class="option" id="sfw-button"> </span>
        <span class="option" id="server-connection-bulb"></span>
      </div>

      <div class="tab-header">
        <div class="tab-link" data-tab="tab-toy">Toy</div>
        <div class="tab-link" data-tab="tab-log">log</div>
      </div>
      <hr />
      <div id="tab-toy" class="tab-content">
        <img id="plug" src="./resources/plug.png" alt="awd" />
      </div>
    </div>
  </body>

  <script type="text/javascript">
    // Tab selector script
    document.addEventListener("DOMContentLoaded", function () {
      const tabs = document.querySelectorAll(".tab-link");
      const contents = document.querySelectorAll(".tab-content");
      //if we haven't got any tabs we are not able to push them
      if (tabs.length <= 1) {
        alert(length(tabs));
        return;
      }

      tabs.forEach((tab) => {
        tab.addEventListener("click", function () {
          const target = this.getAttribute("data-tab");

          tabs.forEach((t) => t.classList.remove("active"));
          contents.forEach((c) => c.classList.remove("active"));

          this.classList.add("active");
          document.getElementById(target).classList.add("active");
        });
      });

      tabs[0].classList.add("active");
      contents[0].classList.add("active");
    });
  </script>

  <script type="text/javascript">
    let plug_vibration_level = 0;
    let reconnectInterval = 1000;
    let socket;

    const bulb = document.getElementById("server-connection-bulb");

    socket = new WebSocket("ws://127.0.0.1:12345/ui");
    console.log("WebSocket created");

    socket.addEventListener("open", (event) => {
      bulb.classList.add("active");
    });

    socket.addEventListener("close", (event) => {
      bulb.classList.remove("active");
    });

    socket.addEventListener("error", (event) => {
      bulb.classList.add("error");
      console.error("WebSocket error: ", event);
      setTimeout(function () {
        bulb.classList.remove("error");
      }, 500);
    });

    socket.addEventListener("message", function (event) {
      console.log("Message from server ", event.data);

      const message = JSON.parse(event.data);
      if (message.ScalarCmd && message.ScalarCmd.Scalars) {
        console.log("Received scalar: ", message.ScalarCmd.Scalars[0].Scalar);
        plug_vibration_level = message.ScalarCmd.Scalars[0].Scalar;
        // infinite shaking animation
        document.getElementById("plug").style.animation = `shake ${
          (1 - plug_vibration_level) / 2
        }s infinite`;
      } else if (message.StopAllDevices || message.StopDevice) {
        console.log("Received stop command");
        plug_vibration_level = 0;
        // stop shaking animation
        document.getElementById("plug").style.animation = "";
      }
    });
  </script>
</html>
